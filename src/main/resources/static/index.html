<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>訂便當系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <h1 class="text-center my-4">XX燒鵝 訂便當系統</h1>
        <form id="orderForm">
            <div class="mb-3">
                <label for="customerName" class="form-label">訂購人姓名</label>
                <input type="text" class="form-control" id="customerName" name="customerName" required>
            </div>
            <div id="orderItems">
                <div class="order-item mb-3">
                    <label for="orderItem1" class="form-label">訂購項目</label>
                    <select class="form-select order-item-select" id="orderItem1" name="orderItems[]" required>
                        <option value="">---請選擇---</option>
                        <!-- 港式腊味飯、麵類 -->
                        <option value="烤鵝腿飯-180">烤鵝腿飯 - 180</option>
                        <option value="招牌烤鵝飯-150">招牌烤鵝飯 - 150</option>
                        <option value="烤鴨腿飯-150">烤鴨腿飯 - 150</option>
                        <option value="各式雞腿飯-120">各式雞腿飯 - 120</option>
                        <option value="綜合三寶飯-120">綜合三寶飯 - 120</option>
                        <option value="港式腊味飯-110">港式腊味飯 - 110</option>
                        <option value="各式雙拼飯-110">各式雙拼飯 - 110</option>
                        <option value="掛爐烤鴨飯-100">掛爐烤鴨飯 - 100</option>
                        <option value="蜜汁叉燒飯-100">蜜汁叉燒飯 - 100</option>
                        <option value="脆皮燒肉飯-100">脆皮燒肉飯 - 100</option>
                        <option value="蜜汁排骨飯-100">蜜汁排骨飯 - 100</option>
                        <option value="白切雞飯-100">白切雞飯 - 100</option>
                        <option value="油雞飯-100">油雞飯 - 100</option>
                        <!-- 麵、河粉、米粉 -->
                        <option value="廣炒麵-180">廣炒麵 - 180</option>
                        <option value="星州炒米粉-170">星州炒米粉 - 170</option>
                        <option value="乾炒叉燒河粉-150">乾炒叉燒河粉 - 150</option>
                        <option value="乾炒牛肉河粉-150">乾炒牛肉河粉 - 150</option>
                        <option value="雲吞湯麵-90">雲吞湯麵 - 90</option>
                        <option value="撈麵-105">撈麵 - 105</option>
                        <!-- 各式炒飯 -->
                        <option value="鹹魚雞粒炒飯-120">鹹魚雞粒炒飯 - 120</option>
                        <option value="廣州炒飯-110">廣州炒飯 - 110</option>
                        <option value="牛肉炒飯-110">牛肉炒飯 - 110</option>
                        <option value="腊味炒飯-110">腊味炒飯 - 110</option>
                        <option value="西式炒飯-110">西式炒飯 - 110</option>
                        <!-- 燒臘拼盤 -->
                        <option value="烤鵝1/4-520">烤鵝 1/4 - 520</option>
                        <option value="烤鵝小-330">烤鵝（小） - 330</option>
                        <option value="烤鴨1/2-480">烤鴨 1/2 - 480</option>
                        <option value="烤鴨1/4-240">烤鴨 1/4 - 240</option>
                        <option value="油雞1/2-450">油雞 1/2 - 450</option>
                        <option value="油雞1/4-230">油雞 1/4 - 230</option>
                        <option value="白切雞1/2-450">白切雞 1/2 - 450</option>
                        <option value="白切雞1/4-230">白切雞 1/4 - 230</option>
                        <option value="蜜汁叉燒大-350">蜜汁叉燒（大） - 350</option>
                        <option value="蜜汁叉燒小-175">蜜汁叉燒（小） - 175</option>
                        <option value="脆皮燒肉大-350">脆皮燒肉（大） - 350</option>
                        <option value="脆皮燒肉小-175">脆皮燒肉（小） - 175</option>
                        <option value="蜜汁排骨大-350">蜜汁排骨（大） - 350</option>
                        <option value="蜜汁排骨小-175">蜜汁排骨（小） - 175</option>
                        <option value="各式雙拼大-350">各式雙拼（大） - 350</option>
                        <option value="各式雙拼小-175">各式雙拼（小） - 175</option>
                        <option value="各式三拼大-400">各式三拼（大） - 400</option>
                        <option value="各式三拼小-250">各式三拼（小） - 250</option>
                        <!-- 湯品類 -->
                        <option value="鮮蝦雲吞湯-70">鮮蝦雲吞湯 - 70</option>
                        <option value="肉粒青雞湯-60">肉粒青雞湯 - 60</option>
                        <option value="魚片皮蛋湯-60">魚片皮蛋湯 - 60</option>
                        <option value="蛋花肉粒湯-60">蛋花肉粒湯 - 60</option>
                        <option value="豬肝湯-50">豬肝湯 - 50</option>
                        <!-- 粥品 -->
                        <option value="鮑魚蝦球粥-150">鮑魚蝦球粥 - 150</option>
                        <option value="鮑魚滑雞粥-150">鮑魚滑雞粥 - 150</option>
                        <option value="蝦球滑雞粥-120">蝦球滑雞粥 - 120</option>
                        <option value="皮蛋瘦肉粥-70">皮蛋瘦肉粥 - 70</option>
                        <option value="魚片瘦肉粥-70">魚片瘦肉粥 - 70</option>
                        <option value="魚片皮蛋粥-70">魚片皮蛋粥 - 70</option>
                        <option value="鮮魚片粥-70">鮮魚片粥 - 70</option>
                        <option value="牛肉片粥-70">牛肉片粥 - 70</option>
                        <option value="豬肝粥-60">豬肝粥 - 60</option>
                        <!-- 小炒類 -->
                        <option value="蠔油炒牛肉大-250">蠔油炒牛肉（大） - 250</option>
                        <option value="蠔油炒牛肉小-200">蠔油炒牛肉（小） - 200</option>
                        <option value="蠔油牛楠大-250">蠔油牛楠（大） - 250</option>
                        <option value="蠔油牛楠小-200">蠔油牛楠（小） - 200</option>
                        <option value="鼓椒炒排骨大-250">鼓椒炒排骨（大） - 250</option>
                        <option value="鼓椒炒排骨小-200">鼓椒炒排骨（小） - 200</option>
                        <option value="滑蛋炒蝦仁大-250">滑蛋炒蝦仁（大） - 250</option>
                        <option value="滑蛋炒蝦仁小-200">滑蛋炒蝦仁（小） - 200</option>
                        <option value="椒鹽焗豬排大-250">椒鹽焗豬排（大） - 250</option>
                        <option value="椒鹽焗豬排小-200">椒鹽焗豬排（小） - 200</option>
                        <option value="炒青菜大-150">炒青菜（大） - 150</option>
                        <option value="炒青菜小-80">炒青菜（小） - 80</option>
                        <!-- 添加更多選項 -->
                    </select>
                </div>
            </div>
            <button type="button" class="btn btn-secondary mb-3" id="addOrderItem">增加更多訂購項目</button>
            <div class="mb-3">
                <label for="totalAmount" class="form-label">總計金額</label>
                <input type="text" class="form-control" id="totalAmount" name="totalAmount" readonly>
            </div>
            <div class="mb-3">
                <label for="remark" class="form-label">備註</label>
                <input type="text" class="form-control" id="remark" name="remark"
                    placeholder="雞腿飯、雙拼飯等等可任選的項目，請在這裡輸入你要的口味">
            </div>
            <button type="submit" class="btn btn-primary">送出訂單</button>
        </form>
        <div class="mt-3" id="all-orders"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            var itemCount = 1;

            const getAllOrders = () => {
                $.ajax({
                    url: 'http://10.100.53.50:8081/orders/get',
                    type: 'GET',
                    success: function (response) {
                        // console.log(response);
                        document.getElementById("all-orders").innerHTML = `
                            已送出的訂單：<br><div class="mb-3">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th scope="col">訂單編號</th>
                                            <th scope="col">訂購人</th>
                                            <th scope="col">訂購餐點</th>
                                            <th scope="col">小計</th>
                                            <th scope="col">備註</th>
                                            <th scope="col">送單時間</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orderTableBody">
                            `;

                        for (let i = 0; i < response.length; i++) {
                            $("#orderTableBody").append(`
                                <tr>
                                    <th scope="row">${response[i].id}</th>
                                    <td>${response[i].customerName}</td>
                                    <td>${response[i].orderItems.map(item => item + "元 ")}</td>
                                    <td>${response[i].totalAmount}元</td>
                                    <td>${response[i].remark}元</td>
                                    <td>${new Date(response[i].timeStamp).toLocaleString()}</td>
                                </tr>
                            `);
                        }
                        $("#all-orders").append(`
                                </tbody>
                            </table>
                        </div`);
                    },
                    error: function (xhr, status, error) {
                        console.log(xhr.responseText);
                    }
                });

            }

            getAllOrders();

            function calculateTotal() {
                let total = 0;
                $('.order-item-select').each(function () {
                    const value = $(this).val();
                    if (value) {
                        total += parseInt(value.split('-')[1]);
                    }
                });
                $('#totalAmount').val(total);
            }

            $('#addOrderItem').click(function () {
                itemCount++;
                const newItem = `<div class="order-item mb-3">
                                <label for="orderItem${itemCount}" class="form-label">訂購項目</label>
                                <select class="form-select order-item-select" id="orderItem${itemCount}" name="orderItems[]" required>
                                    <option value="">---請選擇---</option>
                                    <!-- 港式腊味飯、麵類 -->
                                    <option value="烤鵝腿飯-180">烤鵝腿飯 - 180</option>
                                    <option value="招牌烤鵝飯-150">招牌烤鵝飯 - 150</option>
                                    <option value="烤鴨腿飯-150">烤鴨腿飯 - 150</option>
                                    <option value="各式雞腿飯-120">各式雞腿飯 - 120</option>
                                    <option value="綜合三寶飯-120">綜合三寶飯 - 120</option>
                                    <option value="港式腊味飯-110">港式腊味飯 - 110</option>
                                    <option value="各式雙拼飯-110">各式雙拼飯 - 110</option>
                                    <option value="掛爐烤鴨飯-100">掛爐烤鴨飯 - 100</option>
                                    <option value="蜜汁叉燒飯-100">蜜汁叉燒飯 - 100</option>
                                    <option value="脆皮燒肉飯-100">脆皮燒肉飯 - 100</option>
                                    <option value="蜜汁排骨飯-100">蜜汁排骨飯 - 100</option>
                                    <option value="白切雞飯-100">白切雞飯 - 100</option>
                                    <option value="油雞飯-100">油雞飯 - 100</option>
                                    <!-- 麵、河粉、米粉 -->
                                    <option value="廣炒麵-180">廣炒麵 - 180</option>
                                    <option value="星州炒米粉-170">星州炒米粉 - 170</option>
                                    <option value="乾炒叉燒河粉-150">乾炒叉燒河粉 - 150</option>
                                    <option value="乾炒牛肉河粉-150">乾炒牛肉河粉 - 150</option>
                                    <option value="雲吞湯麵-90">雲吞湯麵 - 90</option>
                                    <option value="撈麵-105">撈麵 - 105</option>
                                    <!-- 各式炒飯 -->
                                    <option value="鹹魚雞粒炒飯-120">鹹魚雞粒炒飯 - 120</option>
                                    <option value="廣州炒飯-110">廣州炒飯 - 110</option>
                                    <option value="牛肉炒飯-110">牛肉炒飯 - 110</option>
                                    <option value="腊味炒飯-110">腊味炒飯 - 110</option>
                                    <option value="西式炒飯-110">西式炒飯 - 110</option>
                                    <!-- 燒臘拼盤 -->
                                    <option value="烤鵝1/4-520">烤鵝 1/4 - 520</option>
                                    <option value="烤鵝小-330">烤鵝（小） - 330</option>
                                    <option value="烤鴨1/2-480">烤鴨 1/2 - 480</option>
                                    <option value="烤鴨1/4-240">烤鴨 1/4 - 240</option>
                                    <option value="油雞1/2-450">油雞 1/2 - 450</option>
                                    <option value="油雞1/4-230">油雞 1/4 - 230</option>
                                    <option value="白切雞1/2-450">白切雞 1/2 - 450</option>
                                    <option value="白切雞1/4-230">白切雞 1/4 - 230</option>
                                    <option value="蜜汁叉燒大-350">蜜汁叉燒（大） - 350</option>
                                    <option value="蜜汁叉燒小-175">蜜汁叉燒（小） - 175</option>
                                    <option value="脆皮燒肉大-350">脆皮燒肉（大） - 350</option>
                                    <option value="脆皮燒肉小-175">脆皮燒肉（小） - 175</option>
                                    <option value="蜜汁排骨大-350">蜜汁排骨（大） - 350</option>
                                    <option value="蜜汁排骨小-175">蜜汁排骨（小） - 175</option>
                                    <option value="各式雙拼大-350">各式雙拼（大） - 350</option>
                                    <option value="各式雙拼小-175">各式雙拼（小） - 175</option>
                                    <option value="各式三拼大-400">各式三拼（大） - 400</option>
                                    <option value="各式三拼小-250">各式三拼（小） - 250</option>
                                    <!-- 湯品類 -->
                                    <option value="鮮蝦雲吞湯-70">鮮蝦雲吞湯 - 70</option>
                                    <option value="肉粒青雞湯-60">肉粒青雞湯 - 60</option>
                                    <option value="魚片皮蛋湯-60">魚片皮蛋湯 - 60</option>
                                    <option value="蛋花肉粒湯-60">蛋花肉粒湯 - 60</option>
                                    <option value="豬肝湯-50">豬肝湯 - 50</option>
                                    <!-- 粥品 -->
                                    <option value="鮑魚蝦球粥-150">鮑魚蝦球粥 - 150</option>
                                    <option value="鮑魚滑雞粥-150">鮑魚滑雞粥 - 150</option>
                                    <option value="蝦球滑雞粥-120">蝦球滑雞粥 - 120</option>
                                    <option value="皮蛋瘦肉粥-70">皮蛋瘦肉粥 - 70</option>
                                    <option value="魚片瘦肉粥-70">魚片瘦肉粥 - 70</option>
                                    <option value="魚片皮蛋粥-70">魚片皮蛋粥 - 70</option>
                                    <option value="鮮魚片粥-70">鮮魚片粥 - 70</option>
                                    <option value="牛肉片粥-70">牛肉片粥 - 70</option>
                                    <option value="豬肝粥-60">豬肝粥 - 60</option>
                                    <!-- 小炒類 -->
                                    <option value="蠔油炒牛肉大-250">蠔油炒牛肉（大） - 250</option>
                                    <option value="蠔油炒牛肉小-200">蠔油炒牛肉（小） - 200</option>
                                    <option value="蠔油牛楠大-250">蠔油牛楠（大） - 250</option>
                                    <option value="蠔油牛楠小-200">蠔油牛楠（小） - 200</option>
                                    <option value="鼓椒炒排骨大-250">鼓椒炒排骨（大） - 250</option>
                                    <option value="鼓椒炒排骨小-200">鼓椒炒排骨（小） - 200</option>
                                    <option value="滑蛋炒蝦仁大-250">滑蛋炒蝦仁（大） - 250</option>
                                    <option value="滑蛋炒蝦仁小-200">滑蛋炒蝦仁（小） - 200</option>
                                    <option value="椒鹽焗豬排大-250">椒鹽焗豬排（大） - 250</option>
                                    <option value="椒鹽焗豬排小-200">椒鹽焗豬排（小） - 200</option>
                                    <option value="炒青菜大-150">炒青菜（大） - 150</option>
                                    <option value="炒青菜小-80">炒青菜（小） - 80</option>
                                    <!-- 添加更多選項 -->
                                </select>
                                <button type="button" class="btn btn-outline-secondary btn-sm mt-1" id="deleteItem">刪除此項目</button>
                             </div>`;
                $('#orderItems').append(newItem);
            });

            $(document).on('click', '#deleteItem', function () {
                $(this).parent().remove();
                calculateTotal();
            });

            // $("#deleteItem").click(function () {
            //     $(this).preventDefault();
            //     $(this).parent().remove();
            //     console.log(1);
            //     calculateTotal();
            // })

            $(document).on('change', '.order-item-select', function () {
                calculateTotal();
            });

            $('#orderForm').submit(function (event) {
                event.preventDefault();
                const formData = {
                    customerName: $('#customerName').val(),
                    orderItems: $('.order-item-select').map(function () { return $(this).val(); }).get(),
                    totalAmount: $('#totalAmount').val(),
                    remark: $('#remark').val()
                };

                $.ajax({
                    url: 'http://10.100.53.50:8081/orders/submit',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function (response) {
                        alert('訂單已送出！');
                        $('#orderForm')[0].reset();
                        $('#orderItems').html(`
                        <div class="order-item mb-3">
                            <label for="orderItem1" class="form-label">訂購項目</label>
                            <select class="form-select order-item-select" id="orderItem1" name="orderItems[]" required>
                                <option value="">---請選擇---</option>
                                <!-- 港式腊味飯、麵類 -->
                                <option value="烤鵝腿飯-180">烤鵝腿飯 - 180</option>
                                <option value="招牌烤鵝飯-150">招牌烤鵝飯 - 150</option>
                                <option value="烤鴨腿飯-150">烤鴨腿飯 - 150</option>
                                <option value="各式雞腿飯-120">各式雞腿飯 - 120</option>
                                <option value="綜合三寶飯-120">綜合三寶飯 - 120</option>
                                <option value="港式腊味飯-110">港式腊味飯 - 110</option>
                                <option value="各式雙拼飯-110">各式雙拼飯 - 110</option>
                                <option value="掛爐烤鴨飯-100">掛爐烤鴨飯 - 100</option>
                                <option value="蜜汁叉燒飯-100">蜜汁叉燒飯 - 100</option>
                                <option value="脆皮燒肉飯-100">脆皮燒肉飯 - 100</option>
                                <option value="蜜汁排骨飯-100">蜜汁排骨飯 - 100</option>
                                <option value="白切雞飯-100">白切雞飯 - 100</option>
                                <option value="油雞飯-100">油雞飯 - 100</option>
                                <!-- 麵、河粉、米粉 -->
                                <option value="廣炒麵-180">廣炒麵 - 180</option>
                                <option value="星州炒米粉-170">星州炒米粉 - 170</option>
                                <option value="乾炒叉燒河粉-150">乾炒叉燒河粉 - 150</option>
                                <option value="乾炒牛肉河粉-150">乾炒牛肉河粉 - 150</option>
                                <option value="雲吞湯麵-90">雲吞湯麵 - 90</option>
                                <option value="撈麵-105">撈麵 - 105</option>
                                <!-- 各式炒飯 -->
                                <option value="鹹魚雞粒炒飯-120">鹹魚雞粒炒飯 - 120</option>
                                <option value="廣州炒飯-110">廣州炒飯 - 110</option>
                                <option value="牛肉炒飯-110">牛肉炒飯 - 110</option>
                                <option value="腊味炒飯-110">腊味炒飯 - 110</option>
                                <option value="西式炒飯-110">西式炒飯 - 110</option>
                                <!-- 燒臘拼盤 -->
                                <option value="烤鵝1/4-520">烤鵝 1/4 - 520</option>
                                <option value="烤鵝小-330">烤鵝（小） - 330</option>
                                <option value="烤鴨1/2-480">烤鴨 1/2 - 480</option>
                                <option value="烤鴨1/4-240">烤鴨 1/4 - 240</option>
                                <option value="油雞1/2-450">油雞 1/2 - 450</option>
                                <option value="油雞1/4-230">油雞 1/4 - 230</option>
                                <option value="白切雞1/2-450">白切雞 1/2 - 450</option>
                                <option value="白切雞1/4-230">白切雞 1/4 - 230</option>
                                <option value="蜜汁叉燒大-350">蜜汁叉燒（大） - 350</option>
                                <option value="蜜汁叉燒小-175">蜜汁叉燒（小） - 175</option>
                                <option value="脆皮燒肉大-350">脆皮燒肉（大） - 350</option>
                                <option value="脆皮燒肉小-175">脆皮燒肉（小） - 175</option>
                                <option value="蜜汁排骨大-350">蜜汁排骨（大） - 350</option>
                                <option value="蜜汁排骨小-175">蜜汁排骨（小） - 175</option>
                                <option value="各式雙拼大-350">各式雙拼（大） - 350</option>
                                <option value="各式雙拼小-175">各式雙拼（小） - 175</option>
                                <option value="各式三拼大-400">各式三拼（大） - 400</option>
                                <option value="各式三拼小-250">各式三拼（小） - 250</option>
                                <!-- 湯品類 -->
                                <option value="鮮蝦雲吞湯-70">鮮蝦雲吞湯 - 70</option>
                                <option value="肉粒青雞湯-60">肉粒青雞湯 - 60</option>
                                <option value="魚片皮蛋湯-60">魚片皮蛋湯 - 60</option>
                                <option value="蛋花肉粒湯-60">蛋花肉粒湯 - 60</option>
                                <option value="豬肝湯-50">豬肝湯 - 50</option>
                                <!-- 粥品 -->
                                <option value="鮑魚蝦球粥-150">鮑魚蝦球粥 - 150</option>
                                <option value="鮑魚滑雞粥-150">鮑魚滑雞粥 - 150</option>
                                <option value="蝦球滑雞粥-120">蝦球滑雞粥 - 120</option>
                                <option value="皮蛋瘦肉粥-70">皮蛋瘦肉粥 - 70</option>
                                <option value="魚片瘦肉粥-70">魚片瘦肉粥 - 70</option>
                                <option value="魚片皮蛋粥-70">魚片皮蛋粥 - 70</option>
                                <option value="鮮魚片粥-70">鮮魚片粥 - 70</option>
                                <option value="牛肉片粥-70">牛肉片粥 - 70</option>
                                <option value="豬肝粥-60">豬肝粥 - 60</option>
                                <!-- 小炒類 -->
                                <option value="蠔油炒牛肉大-250">蠔油炒牛肉（大） - 250</option>
                                <option value="蠔油炒牛肉小-200">蠔油炒牛肉（小） - 200</option>
                                <option value="蠔油牛楠大-250">蠔油牛楠（大） - 250</option>
                                <option value="蠔油牛楠小-200">蠔油牛楠（小） - 200</option>
                                <option value="鼓椒炒排骨大-250">鼓椒炒排骨（大） - 250</option>
                                <option value="鼓椒炒排骨小-200">鼓椒炒排骨（小） - 200</option>
                                <option value="滑蛋炒蝦仁大-250">滑蛋炒蝦仁（大） - 250</option>
                                <option value="滑蛋炒蝦仁小-200">滑蛋炒蝦仁（小） - 200</option>
                                <option value="椒鹽焗豬排大-250">椒鹽焗豬排（大） - 250</option>
                                <option value="椒鹽焗豬排小-200">椒鹽焗豬排（小） - 200</option>
                                <option value="炒青菜大-150">炒青菜（大） - 150</option>
                                <option value="炒青菜小-80">炒青菜（小） - 80</option>
                                <!-- 添加更多選項 -->
                            </select>
                        </div>
                        `);
                        $('#totalAmount').val('');
                        $('#all-orders').empty();
                        getAllOrders();
                    },
                    error: function (xhr, status, error) {
                        alert('訂單送出失敗: ' + xhr.responseText);
                    }
                });
            });
        });
    </script>
</body>

</html>
